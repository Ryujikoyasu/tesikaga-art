# 屈斜路の響き - インタラクティブ・ライトアート


*(▲ シミュレーターの実行画面。左が鳥の思考や位置を示すデバッグビュー、右が物理LEDでの見た目を忠実に再現したアーティスティックビュー)*

北海道・弟子屈町の自然をテーマにした、来場者参加型のインタラクティブアート作品のシミュレーション兼制御ソフトウェアです。来場者の動きを（最終的には）LiDARで検知し、その存在が「小鳥」として表現される光と音の群れに影響を与えます。

テクノロジーを通じて、**人と自然の、繊細で詩的な関わり合い**を体験してもらうことを目指します。

---

## デザイン哲学と技術的ハイライト

このプロジェクトは、単にLEDを光らせるだけではありません。「生命感とは何か？」という問いに対し、コードと物理的な制約を通して向き合った、私たちの探求の記録です。

### 1. 挑戦：シミュレーションと現実の同期

メディアアート開発における最も大きな壁の一つは、PC画面上のシミュレーションと、実際の物理的な展示物との間に生じる「見た目のズレ」です。

> **問題:** 当初、シミュレーターは900個のLEDを個別に制御できるという前提で、滑らかなグラデーションを描画していました。しかし、実際に使用する12VのLEDテープは「3つのLEDが1ピクセルとしてしか制御できない」という物理的制約があります。このままでは、画面を見ながらデザインを調整しても、全く違うものが出来上がってしまい、開発が手探りの当てずっぽうになってしまいます。

**解決策：シミュレーションを「物理に合わせる」**

私たちは、シミュレーションのアーキテクチャを根本から見直し、「物理ピクセル単位」で思考するように再設計しました。

*   **ピクセル中心設計:** 計算、描画、AIの判断基準など、ソフトウェアの全てのロジックが、物理的な300ピクセルを基準に動作します。
*   **忠実なプレビュー:** アーティスティックビュー（右画面）では、個々のピクセルを物理的な見た目に近い「少し大きめの円」として描画します。

これにより、シミュレーターは**100%忠実なプレビュー**として機能します。PC画面で見たものが、そのまま物理世界で再現される。この当たり前でありながら最も重要な「What You See Is What You Get」の原則が、開発の信頼性とスピードを支えています。

### 2. 挑戦：光に「生命感」と「個性」を宿す

LEDは単なる点光源ですが、私たちはそれを「生き物」として感じさせたかった。そのために、光の色と振る舞いに、生物学的な解釈を加えました。

> **問題:** クマゲラのような「黒い鳥」や、ノゴマのような「茶色い鳥」をどう光で表現するか？また、複数の鳥の光が重なり、意図しない「混色」（例：オジロワシの黄色とベニマシコの赤が混ざり、不自然なピンク色が生まれる）が起きるのをどう防ぐか？

**解決策：ハイブリッドAIと、光の「翻訳」**

1.  **色の翻訳:**
    *   **クマゲラの「黒」:** 完全な消灯ではなく`[35, 35, 50]`という**「限りなく黒に近い、深い濃紺」**として表現。これにより、黒い鳥としてのイメージを保ちつつ、光としての存在感を失いません。
    *   **色の構造:** 1羽の鳥を「基本色」と「差し色」の組み合わせで定義し、`color_pattern`によって「濃紺-赤-濃紺」のような色の並びを作ることで、単色ではない豊かな質感を表現しています。

2.  **光のオーラ:**
    *   鳥の光の端が急に消えるのではなく、**最低光量（例: 30%）を維持しながら滑らかに減衰**するようにしました。これにより、光は鋭い点ではなく、柔らかなオーラのように広がり、フォルムが視認しやすくなります。

3.  **1D縄張り意識（ハイブリッドAI）:**
    *   最大の工夫は、鳥のAIに**LEDテープ上での「縄張り意識」**を持たせたことです。鳥たちは2D空間を自由に飛び回りながらも、他の鳥との「LEDテープ上のピクセル距離」を常に監視しています。
    *   もしテープ上で縄張りを侵犯されそうになると、AIは**2D空間上で相手を避ける**ように行動します。これにより、光のオーラが物理的に重なり合う前に互いに距離を取るため、不自然な混色が起こりません。

### 3. 挑戦：アーティストの創造性を支える自動化

手作業による調整には限界があり、創造性の足枷になります。私たちは、反復的で退屈な作業をスクリプトに任せることで、人間がより創造的な部分に集中できる環境を構築しました。

*   **音と光の共演 (`audio_sync_generator.py`):**
    音声解析ライブラリ`librosa`を使い、鳥の鳴き声の「音の立ち上がり」を自動で検出。そのリズムに完璧に同期した光の明滅パターンを計算し、設定ファイル`src/config.py`を**自動生成**します。

*   **作者の「筆跡」 (`artistic_path_generator.py`):**
    LEDの物理的な配置は、作品の印象を決めるキャンバスです。このスクリプトは、アーティストがマウスで描いた自由な曲線を、物理的な制約（全長など）を満たすようにコンピュータが自動調整し、座標データとして保存します。これにより、作品に作者ならではの有機的な「ゆらぎ」が生まれます。

---

## 📂 ファイル構成

```text
tesikaga-art/
├── README.md                 # このファイル
├── main.py                   # シミュレーションのみを実行（開発用）
├── main_real.py              # Arduinoへリアルタイムでデータを送信（本番用）
├── settings.yaml             # ★ユーザーが編集する主要な設定ファイル
├── requirements.txt          # 必要なPythonライブラリ
│
├── src/                      # ソースコードの心臓部
│   ├── objects.py            # Bird, Humanクラス定義 (AIの思考ロジック)
│   ├── simulation.py         # Worldクラス (物理法則とシミュレーション管理)
│   ├── config.py             # 【自動生成】される設定ファイル。直接編集しないこと！
│   └── config_structure.py   # 鳥のパラメータの原本。編集後にジェネレータ実行が必要
│
├── assets/                   # アートワーク素材
│   ├── sounds/               # 鳥の鳴き声の音声ファイル (.mp3)
│   └── data/                 # LEDの物理的な座標データファイル (.csv)
│
├── scripts/                  # 創造性を支える補助スクリプト群
│   ├── artistic_path_generator.py # LEDの座標データを対話的に生成
│   └── audio_sync_generator.py    # 音声ファイルを解析してconfig.pyを自動生成
│
└── arduino/                  # Arduino用のファームウェア
    └── tesikaga_led_controller.ino
```

---

## 🚀 使い方 (Setup & Usage)

#### ステップ1：環境のセットアップ
`requirements.txt`に記載されたライブラリをインストールします。
```bash
pip install -r requirements.txt
```

#### ステップ2：Arduinoの準備
1.  Arduino IDEのライブラリマネージャから**`FastLED`ライブラリ**をインストールします。
2.  `arduino/tesikaga_led_controller.ino`を開き、`NUM_PHYSICAL_LEDS`や`DATA_PIN`をあなたのハードウェア構成に合わせて正しく設定します。
3.  スケッチをArduinoに書き込みます。

#### ステップ3：プロジェクト設定
1.  **`settings.yaml`** を開き、あなたの環境に合わせて`serial_port`（Arduinoの接続ポート）などを正しく設定します。
2.  ハードウェアテスト用にLEDの一部だけを使いたい場合は、`enable_test_mode`を`true`にし、`test_strip_led_count`に使用する物理LEDの数を設定します。

#### ステップ4：【最重要】実行前のビルド手順
このプロジェクトは、実行前に設定ファイルを「ビルド」するステップが必要です。

1.  **LEDレイアウトの生成 (初回 or デザイン変更時):**
    `scripts/artistic_path_generator.py`を実行し、画面の指示に従って対話的にLEDの配置をデザインし、保存します。
    ```bash
    python scripts/artistic_path_generator.py
    ```

2.  **設定ファイルのビルド (初回 or 鳥のパラメータ・音声変更時):**
    `scripts/audio_sync_generator.py`を実行します。これにより、`src/config_structure.py`と`assets/sounds/`が解析され、最新の**`src/config.py`が自動生成されます。**
    ```bash
    python scripts/audio_sync_generator.py
    ```

#### ステップ5：シミュレーションの実行
*   **シミュレーションのみで動きを確認する場合:**
    ```bash
    python main.py
    ```
*   **Arduinoに接続してLEDをリアルタイムで光らせる場合:**
    ```bash
    python main_real.py
    ```

---

## 🛠️ 主要技術スタック
- **Python 3.11+**
- **Pygame-ce:** シミュレーション描画と音声再生
- **NumPy:** 高速なベクトル・配列計算
- **Librosa:** 音声ファイルの解析とOnset検出
- **PyYAML, Matplotlib, PySerial:** ユーティリティ
- **Arduino / C++** with **FastLED:** 堅牢なLEDコントローラー

## 🔮 今後の展望
- [ ] LiDARセンサーとの接続を実装し、マウス操作を現実世界の人の動きに置き換える。
- [ ] 来場者がいない静かな時間帯の、鳥たちのより自然な環境インタラクションを実装する。